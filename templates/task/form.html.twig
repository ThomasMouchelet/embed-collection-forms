{% extends 'base.html.twig' %}

{% block body %}
    <a href="{{ path('task_list') }}">Tasks List</a>
{{ form_start(form) }}
    {{ form_row(form.description) }}

<h3>Tags</h3>

<ul id="sortable" class="tags" data-prototype="{{ form_widget(form.tags.vars.prototype)|e('html_attr') }}">

    {% for tag in form.tags %}
        <li>{{ form_row(tag.name) }}</li>
    {% endfor %}
    <button type="submit">Envoyer</button>
</ul>
{{ form_end(form) }}

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        jQuery(document).ready(function($){
            var $collectionHolder;
            // setup an "add a tag" link
            var $addTagButton = $('<button type="button" class="add_tag_link">Add a tag</button>');

            var $newLinkLi = $('<li></li>').append($addTagButton);
            // Get the ul that holds the collection of tags
            $collectionHolder = $('ul.tags');

            $collectionHolder.find('li').each(function() {
                addTagFormDeleteLink($(this));
            });

            $collectionHolder.append($newLinkLi);

            $collectionHolder.data('index', $collectionHolder.find('input').length);
            $addTagButton.on('click', function(e) {
                addTagForm($collectionHolder, $newLinkLi);
            });

            $( "#sortable" ).sortable();
            $( "#sortable" ).disableSelection();

            function addTagForm($collectionHolder, $newLinkLi) {
                // Get the data-prototype explained earlier
                var prototype = $collectionHolder.data('prototype');
                console.log(prototype)
                // get the new index
                var index = $collectionHolder.data('index');
                var newForm = prototype;
                newForm = newForm.replace(/__name__/g, index);
                $collectionHolder.data('index', index + 1);
                var $newFormLi = $('<li></li>').append(newForm);
                $newLinkLi.before($newFormLi);

                addTagFormDeleteLink($newFormLi);
            }

            function addTagFormDeleteLink($tagFormLi) {
                var $removeFormButton = $('<button type="button">Delete this tag</button>');
                $tagFormLi.append($removeFormButton);
                $removeFormButton.on('click', function(e) {
                    $tagFormLi.remove();
                });
            }
        });
    </script>
{% endblock %}